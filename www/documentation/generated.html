<html xmlns="http://www.w3.org/1999/xhtml" xmlns:c="http://www.w3.org/ns/xproc-step"><head>
        <title>xprocspec</title>
        <meta charset="utf-8"/>
        <script class="remove" src="http://darobin.github.com/respec/builds/respec-w3c-common.js"> </script>
        <script class="remove">
            var respecConfig = {
                "specStatus": "unofficial",
                "shortName": "xprocspec",
                "subtitle": "A tool for testing XProc scripts",
                "edDraftURI": "http://josteinaj.github.io/xprocspec/www/documentation/index.html",
                "editors": [
                    {
                        "name": "Jostein Austvik Jacobsen",
                        "url": "http://github.com/josteinaj",
                        "company": "NLB",
                        "companyURL": "http://www.nlb.no/en/"
                    }
                ]
            };
        </script>
        <style>
            /* based on the CSS used for the HTML5 spec */
            h2 + h3,
            h3 + h4,
            h4 + h5,
            h5 + h6{
                margin-top:0.5em;
            }
            h1,
            h2,
            h3,
            h4,
            h5,
            h6{
                page-break-after:avoid;
            }
            h3{
                position:relative;
                z-index:3;
                padding-top:20px;
            }
            h2 + .element,
            h2 + div + .element,
            h3 + .element,
            h3 + div + .element,
            h4 + .element,
            h4 + div + .element,
            h5 + .element,
            h5 + div + .element,
            h6 + .element,
            h6 + div + .element{
                margin-top:-3em;
                padding-top:2em;
            }
            .element{
                background:#F4F4FA;
                color:black;
                margin:0 0 1em 0.15em;
                padding:0 1em 1em 0.75em;
                border-left:solid #9999FF 0.25em;
                position:relative;
                z-index:1;
            }
            .element:before{
                position:absolute;
                z-index:2;
                top:0;
                left:-1.15em;
                height:2em;
                width:0.9em;
                background:#F4F4FA;
                content:' ';
                border-style:none none solid solid;
                border-color:#9999FF;
                border-width:0.25em;
            }
            section{
                padding-bottom:20px;
            }
            dt{
                padding-top:10px;
            }
            dd{
                padding-top:5px;
            }</style>
    </head>
    <body>
        <section id="abstract"><a href="http://josteinaj.github.io/xprocspec/">xprocspec</a> is a tool for testing XProc scripts. This specification defines the grammar used to define XProc tests for use with xprocspec. This document is automatically
            generated based on the <a href="../../src/main/resources/xml/schema/xprocspec.rng">Relax NG schema for the xprocspec grammar</a>.</section>
        
<section xmlns:x="http://www.daisy.org/ns/pipeline/xproc/test" xmlns:f="http://www.daisy.org/ns/pipeline/xproc/test/internal-functions" xmlns:rng="http://relaxng.org/ns/structure/1.0" xmlns:a="http://relaxng.org/ns/compatibility/annotations/1.0">
<h2>Definitions</h2>
<section id="the-description-element">
<h2>The <code>description</code> element</h2><dl class="element"><dt>Content model:</dt><dd><a href="#the-import-element"><code>import</code></a><small title="zero or more">*</small></dd><dd><a href="#the-scenario-element"><code>scenario</code></a><small title="zero or more">*</small></dd><dd><a href="#the-pending-element"><code>pending</code></a><small title="zero or more">*</small></dd><dt>Content attributes:</dt><dd><a href="#attr-description-pending"><code>pending</code></a><small title="optional">?</small></dd><dd><a href="#attr-description-script"><code>script</code></a></dd><dd><a href="#attr-description-version"><code>version</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>The <a href="#the-description-element"><code>description</code></a> element is the root element of an xprocspec test and describes the functionality of a specific XProc script.</p>

<p id="attr-description-pending">Assertions or scenarios with the <a href="#attr-description-pending"><code>pending</code></a> attribute will remain untested, but will be
               reported as (eventual) desired behaviour. Its semantics is the same as for the
               <a href="#the-pending-element"><code>pending</code></a> element.
               Its content describes why the assertion or scenario should not be evaluated.</p>
<p id="attr-description-script">The <a href="#attr-description-script"><code>script</code></a> attribute is a URI that points to the XProc script you want to test.</p>
<p id="attr-description-version">The <a href="#attr-description-version"><code>version</code></a> attribute can be used to aid development over time.</p>
</section>

<section id="the-import-element">
<h2>The <code>import</code> element</h2><dl class="element"><dt>Content model:</dt><dd>Empty.</dd><dt>Content attributes:</dt><dd><a href="#attr-import-href"><code>href</code></a></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>
                An import runs the xprocspec description in the referenced file. It has no
                effect on the scenarios in the current document, but can be a useful method
                to group xprocspec descriptions into a test suite.
                Importing is recursive and may be circular (although only one copy of a given
                imported document will actually be imported).
            </p>

<p id="attr-import-href">The <a href="#attr-import-href"><code>href</code></a> attribute contains a URI pointing to the xprocspec file to be imported.</p>
</section>

<section id="the-scenario-element">
<h2>The <code>scenario</code> element</h2><dl class="element"><dt>Content model:</dt><dd><a href="#the-call-element"><code>call</code></a><small title="optional">?</small></dd><dd><a href="#the-scenario-element"><code>scenario</code></a><small title="zero or more">*</small></dd><dd><a href="#the-pending-element"><code>pending</code></a><small title="zero or more">*</small></dd><dd><a href="#the-context-element"><code>context</code></a><small title="zero or more">*</small></dd><dd><a href="#the-expect-element"><code>expect</code></a><small title="zero or more">*</small></dd><dt>Content attributes:</dt><dd><a href="#attr-scenario-label"><code>label</code></a></dd><dd><a href="#attr-scenario-pending"><code>pending</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>
                A scenario groups together the definition of the script environment
                (the <a href="#the-call-element"><code>call</code></a> element) and the script assertions (the <a href="#the-context-element"><code>context</code></a> and
                <a href="#the-expect-element"><code>expect</code></a> elements). The <a href="#the-call-element"><code>call</code></a>
                element defines the inputs, options and parameters passed to the step
                and the <a href="#the-context-element"><code>context</code></a> and <a href="#the-expect-element"><code>expect</code></a> elements are used to perform assertions
                on the result. Child scenarios inherit the contents of the <a href="#the-call-element"><code>call</code></a>
                element, but can override its inputs, options and parameters by in its
                own <a href="#the-call-element"><code>call</code></a> element.
            </p>

<p id="attr-scenario-label">The <a href="#attr-scenario-label"><code>label</code></a> attribute is used to describe the current element in human-readable words.</p>
<p id="attr-scenario-pending">Assertions or scenarios with the <a href="#attr-scenario-pending"><code>pending</code></a> attribute will remain untested, but will be
               reported as (eventual) desired behaviour. Its semantics is the same as for the
               <a href="#the-pending-element"><code>pending</code></a> element.
               Its content describes why the assertion or scenario should not be evaluated.</p>
</section>

<section id="the-call-element">
<h2>The <code>call</code> element</h2><dl class="element"><dt>Content model:</dt><dd><a href="#the-input-element"><code>input</code></a><small title="zero or more">*</small></dd><dd><a href="#the-option-element"><code>option</code></a><small title="zero or more">*</small></dd><dd><a href="#the-param-element"><code>param</code></a><small title="zero or more">*</small></dd><dt>Content attributes:</dt><dd><a href="#attr-call-step"><code>step</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>
                A <a href="#the-call-element"><code>call</code></a> element defines a step call and the
                inputs, options and parameters passed to it.
            </p>

<p id="attr-call-step">
                        The <a href="#attr-call-step"><code>step</code></a> attribute is the name of the step (as declared in XProc scripts by the <code>p:declare-step/@type</code> attribute).
                        For instance <code>step="example:mystep"</code>.
                        The <a href="#attr-call-step"><code>step</code></a> attribute must be specified on either the <a href="#the-call-element"><code>call</code></a> element or one of the ancestor <a href="#the-call-element"><code>call</code></a> elements.
                    </p>
</section>



<section id="the-pending-element">
<h2>The <code>pending</code> element</h2><dl class="element"><dt>Content model:</dt><dd><a href="#the-scenario-element"><code>scenario</code></a><small title="zero or more">*</small></dd><dt>Content attributes:</dt><dd><a href="#attr-pending-label"><code>label</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p><em>TODO</em>: the element <code>pending</code> has not been documented yet.</p>

<p id="attr-pending-label">The <a href="#attr-pending-label"><code>label</code></a> attribute is used to describe the current element in human-readable words.</p>
</section>

<section id="the-context-element">
<h2>The <code>context</code> element</h2><dl class="element"><dt>Content model:</dt><dd><a href="#the-document-element"><code>document</code></a><small title="zero or more">*</small></dd><dt>Content attributes:</dt><dd><a href="#attr-context-label"><code>label</code></a><small title="optional">?</small></dd><dd><a href="#attr-context-pending"><code>pending</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>Defines the context against which assertions are made.</p>

<p id="attr-context-label">The <a href="#attr-context-label"><code>label</code></a> attribute is used to describe the current element in human-readable words.</p>
<p id="attr-context-pending">Assertions or scenarios with the <a href="#attr-context-pending"><code>pending</code></a> attribute will remain untested, but will be
               reported as (eventual) desired behaviour. Its semantics is the same as for the
               <a href="#the-pending-element"><code>pending</code></a> element.
               Its content describes why the assertion or scenario should not be evaluated.</p>
</section>

<section id="the-expect-element">
<h2>The <code>expect</code> element</h2><dl class="element"><dt>Content model:</dt><dd><a href="#the-document-element"><code>document</code></a><small title="zero or more">*</small></dd><dt>Content attributes:</dt><dd><a href="#attr-expect-grammar"><code>grammar</code></a><small title="optional">?</small></dd><dd><a href="#attr-expect-label"><code>label</code></a><small title="optional">?</small></dd><dd><a href="#attr-expect-pending"><code>pending</code></a><small title="optional">?</small></dd><dd><a href="#attr-expect-test"><code>test</code></a><small title="optional">?</small></dd><dd><a href="#attr-expect-type"><code>type</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>
                Defines what is expected from the context document(s).
            </p>

<p id="attr-expect-grammar">
                            The <a href="#attr-expect-grammar"><code>grammar</code></a> attribute is used to set the grammar of the <code>x:document</code> element (used when <code>type</code> is <code>validate</code>).
                            The assertion succeeds if all of the documents in context validates against the schema given by the child <code>x:document</code> element.
                        </p>
<p id="attr-expect-label">The <a href="#attr-expect-label"><code>label</code></a> attribute is used to describe the current element in human-readable words.</p>
<p id="attr-expect-pending">Assertions or scenarios with the <a href="#attr-expect-pending"><code>pending</code></a> attribute will remain untested, but will be
               reported as (eventual) desired behaviour. Its semantics is the same as for the
               <a href="#the-pending-element"><code>pending</code></a> element.
               Its content describes why the assertion or scenario should not be evaluated.</p>
<p id="attr-expect-test">
                            When <code>type</code> is <code>xpath</code>, you can use the <a href="#attr-expect-test"><code>test</code></a> attribute to define a XPath expression.
                            The expression will be evaluated to either true or false, representing a successful and a failed test respectively.
                        </p>
<p id="attr-expect-type">The <a href="#attr-expect-type"><code>type</code></a> attribute is used to define the type of assertion you want to make.</p><p>
                            When <code>type</code> is <a href="#the-compare-element"><code>compare</code></a>, you can put a sequence of <code>x:document</code> elements inside the <code>x:expect</code> element.
                            The assertion succeeds if the document sequence in context equals the document sequence inside the <code>x:expect</code> element.
                        </p><p>When <code>type</code> is <a href="#the-validate-element"><code>validate</code></a>, the documents in context is validated against the schema provided in the <code>x:document</code> element inside the <code>x:expect</code> element.</p>
</section>



<section id="the-input-element">
<h2>The <code>input</code> element</h2><dl class="element"><dt>Content model:</dt><dd><a href="#the-document-element"><code>document</code></a><small title="zero or more">*</small></dd><dt>Content attributes:</dt><dd><a href="#attr-input-port"><code>port</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>The input element is used to provide documents on the input ports of the XProc step you are testing.</p>

<p id="attr-input-port"/>
</section>

<section id="the-option-element">
<h2>The <code>option</code> element</h2><dl class="element"><dt>Content model:</dt><dd>Empty.</dd><dt>Content attributes:</dt><dd><a href="#attr-option-name"><code>name</code></a><small title="optional">?</small></dd><dd><a href="#attr-option-select"><code>select</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>The option element is used to provide values to XProc options on the XProc step you are testing.</p>

<p id="attr-option-name">The <a href="#attr-option-name"><code>name</code></a> attribute is the name of the option used in the XProc step.</p>
<p id="attr-option-select">The <a href="#attr-option-select"><code>select</code></a> attribute is a XPath expression used to select a value for the XProc option
                        (equivalent of the <code>p:with-option/@select</code> attribute in XProc).</p><p>The variable "<code>$temp-dir</code>" is available for use in the select expression. The variable refers to the temporary
                        directory used for the test. This is useful (for instance) if the value of
                        the option is a URI pointing to a directory where the XProc steps will store files. Every xprocspec
                        scenario is assigned its own temporary directory so that subsequent evaluations of the step does not conflict
                        with eachother.</p>
</section>

<section id="the-param-element">
<h2>The <code>param</code> element</h2><dl class="element"><dt>Content model:</dt><dd>Empty.</dd><dt>Content attributes:</dt><dd><a href="#attr-param-name"><code>name</code></a><small title="optional">?</small></dd><dd><a href="#attr-param-select"><code>select</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>The param element is used to provide values to XProc paramaters on the XProc step you are testing.</p>

<p id="attr-param-name">The <a href="#attr-param-name"><code>name</code></a> attribute is the name of the parameter to be provided on the XProc steps primary parameter input port.</p>
<p id="attr-param-select">The <a href="#attr-param-select"><code>select</code></a> attribute is a XPath expression used to select a value for the XProc parameter (equivalent of the <code>p:with-param/@select</code> attribute in XProc).</p><p>The variable "<code>$temp-dir</code>" is available for use in the select expression. The variable refers to the temporary directory used for the test. This is useful (for instance) if the value of the parameter is a URI pointing to a
                        directory where the XProc steps will store files. Every xprocspec scenario is assigned its own temporary directory so that subsequent evaluations of the step does not conflict with eachother.</p>
</section>













<section id="the-document-element">
<h2>The <code>document</code> element</h2><dl class="element"><dt>Content model:</dt><dd>One element from any namespace. (optional)</dd><dt>Content attributes:</dt><dd><a href="#attr-document-base-uri"><code>base-uri</code></a><small title="optional">?</small></dd><dd><a href="#attr-document-href"><code>href</code></a><small title="optional">?</small></dd><dd><a href="#attr-document-method"><code>method</code></a><small title="optional">?</small></dd><dd><a href="#attr-document-port"><code>port</code></a><small title="optional">?</small></dd><dd><a href="#attr-document-position"><code>position</code></a><small title="optional">?</small></dd><dd><a href="#attr-document-recursive"><code>recursive</code></a><small title="optional">?</small></dd><dd><a href="#attr-document-type"><code>type</code></a><small title="optional">?</small></dd><dd>Zero or more attributes from any namespace.</dd></dl>
<p>The <a href="#the-document-element"><code>document</code></a> element is used to define which documents are provided on a steps input ports, what the context is when making assertions, and for assertions when making comparisons or performing validations. It can be used in a
                    number of ways:</p>

<p id="attr-document-base-uri">If the <code>base-uri</code> attribute is <code>temp-dir</code>, then the URI in the <a href="#attr-document-href"><code>href</code></a> attribute (or the xml:base attribute of the <code>document</code> or inline element in the case of inline
                                documents) will be resolved against the temporary directory used for the test, instead of the base URI of the xprocspec document.</p><!-- documented in the "inline" group --><!-- documented in the "inline" group -->
<p id="attr-document-href">When <code>type</code> is <code>file</code>; the <a href="#attr-document-href"><code>href</code></a> attribute is a URI pointing to the file you want the contents of.</p><p>When <code>type</code> is <code>directory</code>; the <a href="#attr-document-href"><code>href</code></a> attribute is a URI pointing to the directory you want listed.</p>
<p id="attr-document-method">By default, files loaded by using <code>method="file"</code> will be loaded as XML files. Non-XML files can be loaded by specifying another <code>method</code>.</p>
<p id="attr-document-port">
                            The <code>port</code> is the name of a XProc input or output port.
                            The <code>x:document</code> element will represent the sequence of documents provided on the input port, or the sequence of documents returned on the output port.
                        </p>
<p id="attr-document-position">By specifying the <a href="#attr-document-position"><code>position</code></a> attribute, a certain document in the sequence of documents appearing on the port can be selected.</p>
<p id="attr-document-recursive">
                                By default, the result is the same as invoking the standard XProc step <code>p:directory-list</code>. If you specify the <a href="#attr-document-recursive"><code>recursive</code></a> attribute and give it the value <code>true</code>,
                                you will get a recursive directory listing, listing all subfolders and their contents as well.
                            </p>
<p id="attr-document-type">
                            If the <a href="#attr-document-type"><code>type</code></a> attribute is <a href="#the-inline-element"><code>inline</code></a>, then the <a href="#the-document-element"><code>document</code></a> element is replaced by its content. There must be exactly one element inside the <a href="#the-document-element"><code>document</code></a> element. To specify the base URI of the document, you can specify a
                            <code>xml:base</code> on either the <a href="#the-document-element"><code>document</code></a> element (implicit base URI) or the child element itself (explicit base URI).
                        </p><p>
                            If the <a href="#attr-document-type"><code>type</code></a> attribute is <a href="#the-port-element"><code>port</code></a>, then the <a href="#the-document-element"><code>document</code></a> element will be replaced with the documents on that port. The <a href="#attr-document-position"><code>position</code></a> attribute can be used to select only part of the sequence of documents appearing on that
                            port.
                        </p><p>
                            If the <a href="#attr-document-type"><code>type</code></a> attribute is <a href="#the-file-element"><code>file</code></a>, then the <a href="#the-document-element"><code>document</code></a> element will be replaced by the contents of the file located at the location pointed to by the <a href="#attr-document-href"><code>href</code></a> attribute. The default method for reading files is <code>xml</code>, but by using
                            the <a href="#attr-document-method"><code>method</code></a> attribute you can also choose <code>html</code>, <code>text</code> and <code>binary</code> as methods for loading the file. The <code>href</code> URI is by default resolved against the base URI of the xprocspec test document. However, if you provide the
                            <code>base-uri</code> attribute with a value of <code>temp-dir</code>, then the <code>href</code> URI will be resolved against the temporary directory used for the test instead.
                        </p><p>
                            If the <a href="#attr-document-type"><code>type</code></a> attribute is <a href="#the-directory-element"><code>directory</code></a>, then the <a href="#the-document-element"><code>document</code></a> element will be replaced with a directory listing of the directory pointed to by the <a href="#attr-document-href"><code>href</code></a> attribute. The <code>href</code> URI is
                            by default resolved against the base URI of the xprocspec test document. However, if you provide the <code>base-uri</code> attribute with a value of <code>temp-dir</code>, then the <code>href</code> URI will be resolved against the temporary directory
                            used for the test instead.
                        </p><p>
                            If the <a href="#attr-document-type"><code>type</code></a> attribute is <code>errors</code>, then a <code>c:errors</code> document (as defined in the XProc spec) will be made available if any errors occur during step execution.
                            If no errors occur, an empty sequence is returned.
                        </p>
</section>





</section>
        <section class="appendix">
            <h2>Acknowledgements</h2>
            <p>This specification is based on the work done by the developers of <a href="https://code.google.com/p/xspec/">XSpec</a>.</p>
            <p>The structure of this specification is generated with the help of <a href="https://github.com/darobin/respec" target="_blank">respec</a> (for the W3C-style specification).</p>
            <p>The xprocspec implementation itself currently depends on the XProc processor <a href="http://xmlcalabash.com/" target="_blank">XML Calabash</a> for its implementation of dynamic pipeline evaluation (<a href="http://xmlcalabash.com/docs/reference/cx-eval.html">cx:eval</a>).</p>
        </section>
        <script type="text/javascript" xmlU00003Aspace="preserve">//&lt;![CDATA[
            try {
                var pageTracker = _gat._getTracker("UA-42132238-1");
                pageTracker._trackPageview();
            }
            catch (err) {
            }//]]&gt;</script>
    

</body></html>